---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import { isAuthenticated } from "../config/auth0";
---

<Layout>
  <Header />
  <main id="main-content">
    <section class="login-section">
      <h1 class="login-title">Login</h1>
      <p class="login-description">
        Please log in to access the admin area.
      </p>
      <button id="login-button" class="login-button">
        Log In
      </button>
      <div id="error-message" class="error-message"></div>
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .login-section {
    @apply py-12 text-center;
  }
  .login-title {
    @apply mb-4 text-4xl font-bold tracking-tight;
  }
  .login-description {
    @apply mb-8 text-lg text-skin-base/90;
  }
  .login-button {
    @apply rounded-md bg-skin-accent px-6 py-3 text-white font-medium
    transition-colors duration-200 hover:bg-opacity-90;
  }
  .error-message {
    @apply mt-4 text-red-500;
  }
</style>

<script>
  import { login } from "../utils/auth0Client";
  import { isAuthenticated } from "../config/auth0";

  function initLogin() {
    console.log("Login page loaded");

    // Check if user is already authenticated
    if (isAuthenticated()) {
      console.log("User is already authenticated, redirecting to admin");
      window.location.href = "/admin";
      return;
    }

    const loginButton = document.getElementById("login-button");
    const errorElement = document.getElementById("error-message");

    if (loginButton) {
      loginButton.addEventListener("click", async () => {
        try {
          console.log("Login button clicked, starting login process");
          await login();
        } catch (err) {
          const error = err as Error;
          console.error("Login failed:", error);
          if (errorElement) {
            errorElement.textContent = `Login failed: ${error.message || 'Unknown error'}`;
          }
        }
      });
    }
  }

  // Initialize when the DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLogin);
  } else {
    initLogin();
  }
</script> 